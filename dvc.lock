initialize_environment:
  cmd: make uninstall && make init && direnv allow .
  deps:
  - path: .envrc
    md5: e96d44034195f2650f6298a5c0062728
  - path: environment.yml
    md5: 3cd6521773f3b954d12b25c18b46f8d2
  - path: requirements-app.txt
    md5: 7fb6d824fa5571e63a5593a1da77b479
  - path: setup.sh
    md5: b0c5497ca0f37a515a4e88feb4d57c24
  - path: xbert/
    md5: 63b53a9cc232ce4cdc9b796343751d6a.dir
prepare_for_xbert:
  cmd: $PY_CONDA pipeline/xbert_preprocessing.py
  deps:
  - path: data/ICD_general_equivalence_mapping.csv
    md5: d053c2a2933f5665aff5aa64c9b941cb
  - path: data/intermediary-data/filtered_notes/NOTEEVENTS.FILTERED.csv.gz
    md5: 74036a5a0bbdc0b30d60cff3eb6d3ecb
  - path: data/mimiciii-14/DIAGNOSES_ICD.csv.gz
    md5: 1d8007cc3115fd87a95321df33e1de86
  - path: data/mimiciii-14/D_ICD_DIAGNOSES.csv.gz
    md5: 9c5b6a1e0c6ebe7a96b99441ca9c0499
  - path: data/mimiciii-14/D_ICD_PROCEDURES.csv
    md5: a9707e5361f939f45ca2bc2eb8bd5652
  - path: data/mimiciii-14/PROCEDURES_ICD.csv
    md5: ed7e6f1efa7e334404f6fb26e4c3c7d2
  - path: pipeline/format_data_for_training.py
    md5: db0d19a03e89865e58262e63ee2d2251
  - path: pipeline/xbert_preprocessing.py
    md5: ae5147f6ae1fdecf7236dc43a212b03f
  params:
    params.yaml:
      prepare_for_xbert.diag_or_proc: diag
      prepare_for_xbert.icd_version: '9'
      prepare_for_xbert.subsampling: false
  outs:
  - path: data/intermediary-data/df_test.pkl
    md5: b137323aea9b1f4cb439cc9369ddd14f
  - path: data/intermediary-data/df_train.pkl
    md5: 6dd0e968792655765abaa2dda06b6f2d
  - path: data/intermediary-data/xbert_inputs/X.trn.npz
    md5: 963b307e36c5c7a597dd2d33cc57e392
  - path: data/intermediary-data/xbert_inputs/X.tst.npz
    md5: 13b5fd5890d40e15ef98dcefef897ee3
  - path: data/intermediary-data/xbert_inputs/Y.trn.npz
    md5: 686e0a64f1cac16eed85c213c83d4201
  - path: data/intermediary-data/xbert_inputs/Y.tst.npz
    md5: a5b2d7f0f7ed2e2358ba930b7ace4023
  - path: data/intermediary-data/xbert_inputs/label_map.txt
    md5: ebd9deb52ffd940906a494e994b35142
  - path: data/intermediary-data/xbert_inputs/test_raw_texts.txt
    md5: 47b8e431c51d0b807715a895b025eef8
  - path: data/intermediary-data/xbert_inputs/train_raw_texts.txt
    md5: 1391297165aed064fbcb66c6d8f3ea51
xbert_label_embedding:
  cmd: ./run_preprocess_label.sh
  deps:
  - path: data/intermediary-data/xbert_inputs/X.trn.npz
    md5: 963b307e36c5c7a597dd2d33cc57e392
  - path: data/intermediary-data/xbert_inputs/X.tst.npz
    md5: 13b5fd5890d40e15ef98dcefef897ee3
  - path: data/intermediary-data/xbert_inputs/Y.trn.npz
    md5: 686e0a64f1cac16eed85c213c83d4201
  - path: data/intermediary-data/xbert_inputs/Y.tst.npz
    md5: a5b2d7f0f7ed2e2358ba930b7ace4023
  - path: data/intermediary-data/xbert_inputs/label_map.txt
    md5: ebd9deb52ffd940906a494e994b35142
  - path: data/intermediary-data/xbert_inputs/test_raw_texts.txt
    md5: 47b8e431c51d0b807715a895b025eef8
  - path: data/intermediary-data/xbert_inputs/train_raw_texts.txt
    md5: 1391297165aed064fbcb66c6d8f3ea51
  - path: run_preprocess_label.sh
    md5: 62209926b140e6733324b00efeb79821
  - path: xbert/preprocess.py
    md5: b22b8f7ee6241d0bba7cfe9d3b65c6ab
  outs:
  - path: data/intermediary-data/xbert_outputs/pifa-tfidf-s0/indexer/code.npz
    md5: 950fc93619722cd351281fb606ea3d78
  - path: data/intermediary-data/xbert_outputs/pifa-tfidf-s0/indexer/config.json
    md5: cb14f4a89207cc03790c97efd087fba9
  - path: data/intermediary-data/xbert_outputs/pifa-tfidf-s1/indexer/code.npz
    md5: 0edcd56012959d9fa2c72faa5a66bf63
  - path: data/intermediary-data/xbert_outputs/pifa-tfidf-s1/indexer/config.json
    md5: da9fd0d2d3758562dd40321c926990cc
  - path: data/intermediary-data/xbert_outputs/pifa-tfidf-s2/indexer/code.npz
    md5: dd62e0b39f870244a3d40269d4dd2c1e
  - path: data/intermediary-data/xbert_outputs/pifa-tfidf-s2/indexer/config.json
    md5: 9446390933ab8ea0c01994a519f1556c
  - path: data/intermediary-data/xbert_outputs/proc_data/C.trn.pifa-tfidf-s0.npz
    md5: f6ed7388e862dcbeb213a8d04e168d49
  - path: data/intermediary-data/xbert_outputs/proc_data/C.tst.pifa-tfidf-s0.npz
    md5: 7a4137032dd9402df198a85d353fcd72
  - path: data/intermediary-data/xbert_outputs/proc_data/L.pifa-tfidf.npz
    md5: 947b2374c79abd941805bc05edf88fad
xbert_feat_embedding:
  cmd: ./run_preprocess_feat.sh
  deps:
  - path: data/intermediary-data/xbert_inputs/X.trn.npz
    md5: 963b307e36c5c7a597dd2d33cc57e392
  - path: data/intermediary-data/xbert_inputs/X.tst.npz
    md5: 13b5fd5890d40e15ef98dcefef897ee3
  - path: data/intermediary-data/xbert_inputs/Y.trn.npz
    md5: 686e0a64f1cac16eed85c213c83d4201
  - path: data/intermediary-data/xbert_inputs/Y.tst.npz
    md5: a5b2d7f0f7ed2e2358ba930b7ace4023
  - path: data/intermediary-data/xbert_inputs/test_raw_texts.txt
    md5: 47b8e431c51d0b807715a895b025eef8
  - path: data/intermediary-data/xbert_inputs/train_raw_texts.txt
    md5: 1391297165aed064fbcb66c6d8f3ea51
  - path: run_preprocess_feat.sh
    md5: 9d53c29d3be4814a9a79e520e610ff72
  - path: xbert/preprocess.py
    md5: b22b8f7ee6241d0bba7cfe9d3b65c6ab
  params:
    params.yaml:
      max_seq_len: 4096
  outs:
  - path: data/intermediary-data/xbert_outputs/proc_data/X.trn.tomodel.pkl
    md5: c4243c9536d36c4a0aa7582dd488458d
  - path: data/intermediary-data/xbert_outputs/proc_data/X.tst.tomodel.pkl
    md5: 8f61786f5262fc3dfce90b3a25ab0ba8
xbert_model_training:
  cmd: ./run_transformer_train.sh
  deps:
  - path: data/intermediary-data/xbert_outputs/proc_data/C.trn.pifa-tfidf-s0.npz
    md5: f6ed7388e862dcbeb213a8d04e168d49
  - path: data/intermediary-data/xbert_outputs/proc_data/C.tst.pifa-tfidf-s0.npz
    md5: 7a4137032dd9402df198a85d353fcd72
  - path: data/intermediary-data/xbert_outputs/proc_data/L.pifa-tfidf.npz
    md5: 947b2374c79abd941805bc05edf88fad
  - path: data/intermediary-data/xbert_outputs/proc_data/X.trn.tomodel.pkl
    md5: c4243c9536d36c4a0aa7582dd488458d
  - path: data/intermediary-data/xbert_outputs/proc_data/X.tst.tomodel.pkl
    md5: 8f61786f5262fc3dfce90b3a25ab0ba8
  - path: run_transformer_train.sh
    md5: f104832cb7e2fb2214e72f113881b545
  - path: xbert/transformer.py
    md5: bd8930a71ac25196cdc384599e68a8e1
  params:
    params.yaml:
      max_seq_len: 4096
  outs:
  - path: data/intermediary-data/xbert_outputs/pifa-tfidf-s0/matcher/training_args.bin
    md5: 7d0a6646d2be314c4250bfac6181614f
xbert_trained_model_prediction:
  cmd: ./run_transformer_training_prediction.sh
  deps:
  - path: data/intermediary-data/xbert_outputs/pifa-tfidf-s0/matcher/training_args.bin
    md5: 7d0a6646d2be314c4250bfac6181614f
  - path: data/intermediary-data/xbert_outputs/proc_data/C.trn.pifa-tfidf-s0.npz
    md5: f6ed7388e862dcbeb213a8d04e168d49
  - path: data/intermediary-data/xbert_outputs/proc_data/C.tst.pifa-tfidf-s0.npz
    md5: 7a4137032dd9402df198a85d353fcd72
  - path: data/intermediary-data/xbert_outputs/proc_data/L.pifa-tfidf.npz
    md5: 947b2374c79abd941805bc05edf88fad
  - path: data/intermediary-data/xbert_outputs/proc_data/X.trn.tomodel.pkl
    md5: c4243c9536d36c4a0aa7582dd488458d
  - path: data/intermediary-data/xbert_outputs/proc_data/X.tst.tomodel.pkl
    md5: 8f61786f5262fc3dfce90b3a25ab0ba8
  - path: run_transformer_training_prediction.sh
    md5: fd32dab5847ddc8d55cc1acf8e33606d
  params:
    params.yaml:
      max_seq_len: 4096
  outs:
  - path: data/intermediary-data/xbert_outputs/pifa-tfidf-s0/matcher/C_trn_pred.npz
    md5: abea9e83a58376f47ef1409bb2a9d5db
  - path: data/intermediary-data/xbert_outputs/pifa-tfidf-s0/matcher/C_tst_pred.npz
    md5: eedc7d0a46d21d827af6f8743349468b
  - path: data/intermediary-data/xbert_outputs/pifa-tfidf-s0/matcher/trn_embeddings.npy
    md5: 9e7ba5bcd0ca19d3c4b6e95b9e83191d
  - path: data/intermediary-data/xbert_outputs/pifa-tfidf-s0/matcher/tst_embeddings.npy
    md5: 03cbd79843d02e0b41a4041e435fadbf
xbert_ranker_and_eval:
  cmd: ./run_transformer_predict.sh
  deps:
  - path: data/intermediary-data/xbert_inputs/X.trn.npz
    md5: 963b307e36c5c7a597dd2d33cc57e392
  - path: data/intermediary-data/xbert_inputs/X.tst.npz
    md5: 13b5fd5890d40e15ef98dcefef897ee3
  - path: data/intermediary-data/xbert_inputs/Y.trn.npz
    md5: 686e0a64f1cac16eed85c213c83d4201
  - path: data/intermediary-data/xbert_inputs/Y.tst.npz
    md5: a5b2d7f0f7ed2e2358ba930b7ace4023
  - path: data/intermediary-data/xbert_outputs/pifa-tfidf-s0/indexer/code.npz
    md5: 950fc93619722cd351281fb606ea3d78
  - path: data/intermediary-data/xbert_outputs/pifa-tfidf-s0/matcher/C_trn_pred.npz
    md5: abea9e83a58376f47ef1409bb2a9d5db
  - path: data/intermediary-data/xbert_outputs/pifa-tfidf-s0/matcher/C_tst_pred.npz
    md5: eedc7d0a46d21d827af6f8743349468b
  - path: data/intermediary-data/xbert_outputs/pifa-tfidf-s0/matcher/trn_embeddings.npy
    md5: 9e7ba5bcd0ca19d3c4b6e95b9e83191d
  - path: data/intermediary-data/xbert_outputs/pifa-tfidf-s0/matcher/tst_embeddings.npy
    md5: 03cbd79843d02e0b41a4041e435fadbf
  - path: run_transformer_predict.sh
    md5: 6d74f0fff2e7f90d0fe8493616ea7702
  - path: xbert/evaluator.py
    md5: db7fc81df488eff294e7f9738c7c1162
  - path: xbert/ranker.py
    md5: 594009ea20d82965f0f35371a0902f05
  outs:
  - path: data/intermediary-data/xbert_outputs/pifa-tfidf-s0/ranker/tst.pred.npz
    md5: 94d233bb64c6a8027dbeb44b603f2e96
convert_longformer:
  cmd: $PY_CONDA custom_models/elongate_bioclinical_BERT.py
filter_text_notes:
  cmd: $PY_CONDA pipeline/filter_notes.py
  deps:
  - path: data/mimiciii-14/NOTEEVENTS.csv.gz
    md5: d0345c072f1e3107c56cfa76c83b48a9
  - path: pipeline/filter_notes.py
    md5: dfbf63a5d8c7e163e7d90d8d95650071
  outs:
  - path: data/intermediary-data/filtered_notes/NOTEEVENTS.FILTERED.csv.gz
    md5: 74036a5a0bbdc0b30d60cff3eb6d3ecb
