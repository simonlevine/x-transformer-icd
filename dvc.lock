initialize_environment:
  cmd: make uninstall && make init && direnv allow .
  deps:
  - path: .envrc
    md5: e96d44034195f2650f6298a5c0062728
  - path: environment.yml
    md5: 3cd6521773f3b954d12b25c18b46f8d2
  - path: requirements-app.txt
    md5: 7fb6d824fa5571e63a5593a1da77b479
  - path: setup.sh
    md5: b0c5497ca0f37a515a4e88feb4d57c24
  - path: xbert/
    md5: 63b53a9cc232ce4cdc9b796343751d6a.dir
prepare_for_xbert:
  cmd: $PY_CONDA pipeline/xbert_preprocessing.py
  deps:
  - path: data/ICD_general_equivalence_mapping.csv
    md5: d053c2a2933f5665aff5aa64c9b941cb
  - path: data/intermediary-data/filtered_notes/NOTEEVENTS.FILTERED.csv.gz
    md5: 11af42631fb26a6b46c61433452fbc91
  - path: data/mimiciii-14/DIAGNOSES_ICD.csv.gz
    md5: 1d8007cc3115fd87a95321df33e1de86
  - path: data/mimiciii-14/D_ICD_DIAGNOSES.csv.gz
    md5: 9c5b6a1e0c6ebe7a96b99441ca9c0499
  - path: data/mimiciii-14/D_ICD_PROCEDURES.csv
    md5: a9707e5361f939f45ca2bc2eb8bd5652
  - path: data/mimiciii-14/PROCEDURES_ICD.csv
    md5: ed7e6f1efa7e334404f6fb26e4c3c7d2
  - path: pipeline/format_data_for_training.py
    md5: ac1bbd834b1ebd2dbdfaada6c8383de6
  - path: pipeline/xbert_preprocessing.py
    md5: b27015d4ecf56f78276adf5a954a5cad
  params:
    params.yaml:
      prepare_for_xbert.diag_or_proc: diag
      prepare_for_xbert.icd_version: '9'
      prepare_for_xbert.subsampling: true
  outs:
  - path: data/intermediary-data/df_test.pkl
    md5: a6ccd5a0a7cd68d0ec51a5f50e5b8bc0
  - path: data/intermediary-data/df_train.pkl
    md5: bca4afcdfe18c24dba1a2d0ebc0bc78d
  - path: data/intermediary-data/xbert_inputs/X.trn.npz
    md5: 85a53b7954afc99f88d3ad0976ef647b
  - path: data/intermediary-data/xbert_inputs/X.tst.npz
    md5: 19ebf2851285c4fc49747a2c70e4c3de
  - path: data/intermediary-data/xbert_inputs/Y.trn.npz
    md5: 4eb79a03e20ea3f442a1ae0c572ec7fc
  - path: data/intermediary-data/xbert_inputs/Y.tst.npz
    md5: 4e4508efc84dc28b04299becb8233890
  - path: data/intermediary-data/xbert_inputs/label_map.txt
    md5: d1c43b5896b66d5f54b120de7b535ff1
  - path: data/intermediary-data/xbert_inputs/test_raw_texts.txt
    md5: 0f286c2ef5898110d726679225748585
  - path: data/intermediary-data/xbert_inputs/train_raw_texts.txt
    md5: 457318522eef692fded2103e3274afb0
xbert_label_embedding:
  cmd: ./run_preprocess_label.sh
  deps:
  - path: data/intermediary-data/xbert_inputs/X.trn.npz
    md5: bce791226498eca76160b8668e219be2
  - path: data/intermediary-data/xbert_inputs/X.tst.npz
    md5: b42163ed7475ed8a123d5ba5783c3ebf
  - path: data/intermediary-data/xbert_inputs/Y.trn.npz
    md5: 09175655630dd8f639904df0b26f9270
  - path: data/intermediary-data/xbert_inputs/Y.tst.npz
    md5: f6e756d9723bd502e66c0b7610658329
  - path: data/intermediary-data/xbert_inputs/label_map.txt
    md5: d1c43b5896b66d5f54b120de7b535ff1
  - path: data/intermediary-data/xbert_inputs/test_raw_texts.txt
    md5: 1a59f28ffa2d484df2d34f92eb8b47cd
  - path: data/intermediary-data/xbert_inputs/train_raw_texts.txt
    md5: 90c05d486086fcaaba2e8918cbcfa9ca
  - path: run_preprocess_label.sh
    md5: 1f6e330b582b38ae82bc70059ea93173
  - path: xbert/preprocess.py
    md5: e29025f48ff2ebb4b3646528da2a7ce8
  outs:
  - path: data/intermediary-data/xbert_outputs/pifa-tfidf-s0/indexer/code.npz
    md5: 85a5a0b55d7b3a045d7241b20cf55d18
  - path: data/intermediary-data/xbert_outputs/pifa-tfidf-s0/indexer/config.json
    md5: cb14f4a89207cc03790c97efd087fba9
  - path: data/intermediary-data/xbert_outputs/pifa-tfidf-s1/indexer/code.npz
    md5: 67f98c192c2a3380289ab4b5d4bd8873
  - path: data/intermediary-data/xbert_outputs/pifa-tfidf-s1/indexer/config.json
    md5: da9fd0d2d3758562dd40321c926990cc
  - path: data/intermediary-data/xbert_outputs/pifa-tfidf-s2/indexer/code.npz
    md5: 45f0906d1517133d6f4694045e5698ce
  - path: data/intermediary-data/xbert_outputs/pifa-tfidf-s2/indexer/config.json
    md5: 9446390933ab8ea0c01994a519f1556c
  - path: data/intermediary-data/xbert_outputs/proc_data/C.trn.pifa-tfidf-s0.npz
    md5: dc6f710fe905027fa8baa2e43152e22d
  - path: data/intermediary-data/xbert_outputs/proc_data/C.tst.pifa-tfidf-s0.npz
    md5: e0fcd8fe470aacf5d3a50a1b8c0a1846
  - path: data/intermediary-data/xbert_outputs/proc_data/L.pifa-tfidf.npz
    md5: c79978d9099ff7fd03e6fe8c05e6e73f
xbert_feat_embedding:
  cmd: ./run_preprocess_feat.sh
  deps:
  - path: data/intermediary-data/xbert_inputs/X.trn.npz
    md5: bce791226498eca76160b8668e219be2
  - path: data/intermediary-data/xbert_inputs/X.tst.npz
    md5: b42163ed7475ed8a123d5ba5783c3ebf
  - path: data/intermediary-data/xbert_inputs/Y.trn.npz
    md5: 09175655630dd8f639904df0b26f9270
  - path: data/intermediary-data/xbert_inputs/Y.tst.npz
    md5: f6e756d9723bd502e66c0b7610658329
  - path: data/intermediary-data/xbert_inputs/test_raw_texts.txt
    md5: 1a59f28ffa2d484df2d34f92eb8b47cd
  - path: data/intermediary-data/xbert_inputs/train_raw_texts.txt
    md5: 90c05d486086fcaaba2e8918cbcfa9ca
  - path: run_preprocess_feat.sh
    md5: a3c239b802cc82ff5a69df9b47a66b5e
  - path: xbert/preprocess.py
    md5: e29025f48ff2ebb4b3646528da2a7ce8
  params:
    params.yaml:
      max_seq_len: 512
  outs:
  - path: data/intermediary-data/xbert_outputs/proc_data/X.trn.tomodel.pkl
    md5: 89c3e67eabc2f3f72845cbdbe464ad70
  - path: data/intermediary-data/xbert_outputs/proc_data/X.tst.tomodel.pkl
    md5: c3bf0abdc755b5341debf9987c71826d
xbert_model_training:
  cmd: ./run_transformer_train.sh
  deps:
  - path: data/intermediary-data/xbert_outputs/proc_data/C.trn.pifa-tfidf-s0.npz
    md5: dc6f710fe905027fa8baa2e43152e22d
  - path: data/intermediary-data/xbert_outputs/proc_data/C.tst.pifa-tfidf-s0.npz
    md5: e0fcd8fe470aacf5d3a50a1b8c0a1846
  - path: data/intermediary-data/xbert_outputs/proc_data/L.pifa-tfidf.npz
    md5: c79978d9099ff7fd03e6fe8c05e6e73f
  - path: data/intermediary-data/xbert_outputs/proc_data/X.trn.tomodel.pkl
    md5: 89c3e67eabc2f3f72845cbdbe464ad70
  - path: data/intermediary-data/xbert_outputs/proc_data/X.tst.tomodel.pkl
    md5: c3bf0abdc755b5341debf9987c71826d
  - path: run_transformer_train.sh
    md5: 59dcac2483bafeb35e8f5d8b680a939c
  - path: xbert/transformer.py
    md5: 42e5fd6159e2d10e6e6a764c216ccd4d
  params:
    params.yaml:
      max_seq_len: 512
  outs:
  - path: data/intermediary-data/xbert_outputs/pifa-tfidf-s0/matcher/training_args.bin
    md5: 29fcaeacc7979f1cdeb3caa9a9bcbc1c
xbert_trained_model_prediction:
  cmd: ./run_transformer_training_prediction.sh
  deps:
  - path: data/intermediary-data/xbert_outputs/pifa-tfidf-s0/matcher/training_args.bin
    md5: 29fcaeacc7979f1cdeb3caa9a9bcbc1c
  - path: data/intermediary-data/xbert_outputs/proc_data/C.trn.pifa-tfidf-s0.npz
    md5: dc6f710fe905027fa8baa2e43152e22d
  - path: data/intermediary-data/xbert_outputs/proc_data/C.tst.pifa-tfidf-s0.npz
    md5: e0fcd8fe470aacf5d3a50a1b8c0a1846
  - path: data/intermediary-data/xbert_outputs/proc_data/L.pifa-tfidf.npz
    md5: c79978d9099ff7fd03e6fe8c05e6e73f
  - path: data/intermediary-data/xbert_outputs/proc_data/X.trn.tomodel.pkl
    md5: 89c3e67eabc2f3f72845cbdbe464ad70
  - path: data/intermediary-data/xbert_outputs/proc_data/X.tst.tomodel.pkl
    md5: c3bf0abdc755b5341debf9987c71826d
  - path: run_transformer_training_prediction.sh
    md5: a433791374c42fb1c87c63f3f81931ba
  params:
    params.yaml:
      max_seq_len: 512
  outs:
  - path: data/intermediary-data/xbert_outputs/pifa-tfidf-s0/matcher/C_trn_pred.npz
    md5: 2664e5822ac530d8164e35d7be707821
  - path: data/intermediary-data/xbert_outputs/pifa-tfidf-s0/matcher/C_tst_pred.npz
    md5: 9746443d387442d408748bc497e9b3b8
  - path: data/intermediary-data/xbert_outputs/pifa-tfidf-s0/matcher/trn_embeddings.npy
    md5: 14081458691f106182a6b00e8a9cfd3c
  - path: data/intermediary-data/xbert_outputs/pifa-tfidf-s0/matcher/tst_embeddings.npy
    md5: 11af11d47af29a29ab94511aff6e9a4c
xbert_ranker_and_eval:
  cmd: ./run_transformer_predict.sh
  deps:
  - path: data/intermediary-data/xbert_inputs/X.trn.npz
    md5: bce791226498eca76160b8668e219be2
  - path: data/intermediary-data/xbert_inputs/X.tst.npz
    md5: b42163ed7475ed8a123d5ba5783c3ebf
  - path: data/intermediary-data/xbert_inputs/Y.trn.npz
    md5: 09175655630dd8f639904df0b26f9270
  - path: data/intermediary-data/xbert_inputs/Y.tst.npz
    md5: f6e756d9723bd502e66c0b7610658329
  - path: data/intermediary-data/xbert_outputs/pifa-tfidf-s0/indexer/code.npz
    md5: 85a5a0b55d7b3a045d7241b20cf55d18
  - path: data/intermediary-data/xbert_outputs/pifa-tfidf-s0/matcher/C_trn_pred.npz
    md5: 2664e5822ac530d8164e35d7be707821
  - path: data/intermediary-data/xbert_outputs/pifa-tfidf-s0/matcher/C_tst_pred.npz
    md5: 9746443d387442d408748bc497e9b3b8
  - path: data/intermediary-data/xbert_outputs/pifa-tfidf-s0/matcher/trn_embeddings.npy
    md5: 14081458691f106182a6b00e8a9cfd3c
  - path: data/intermediary-data/xbert_outputs/pifa-tfidf-s0/matcher/tst_embeddings.npy
    md5: 11af11d47af29a29ab94511aff6e9a4c
  - path: run_transformer_predict.sh
    md5: f886c6d321d4d89bf2f75c009b044bf2
  - path: xbert/evaluator.py
    md5: db7fc81df488eff294e7f9738c7c1162
  - path: xbert/ranker.py
    md5: 594009ea20d82965f0f35371a0902f05
  outs:
  - path: data/intermediary-data/xbert_outputs/pifa-tfidf-s0/ranker/tst.pred.npz
    md5: 34c91da7c3a87ba136b3ed889f564baa
convert_longformer:
  cmd: $PY_CONDA custom_models/elongate_bioclinical_BERT.py
filter_text_notes:
  cmd: $PY_CONDA pipeline/filter_notes.py
  deps:
  - path: data/mimiciii-14/NOTEEVENTS.csv.gz
    md5: d0345c072f1e3107c56cfa76c83b48a9
  - path: pipeline/filter_notes.py
    md5: 8a7a4dc15ac3e73aa357a1ad7cb40ef2
  outs:
  - path: data/intermediary-data/filtered_notes/NOTEEVENTS.FILTERED.csv.gz
    md5: 11af42631fb26a6b46c61433452fbc91
