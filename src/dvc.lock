prepare_for_xbert:
  cmd: .venv/bin/python pipeline/xbert_preprocessing.py
  deps:
  - path: ../data/ICD_general_equivalence_mapping.csv
    md5: d053c2a2933f5665aff5aa64c9b941cb
  - path: ../data/mimiciii-14/DIAGNOSES_ICD.csv.gz
    md5: 1d8007cc3115fd87a95321df33e1de86
  - path: ../data/mimiciii-14/D_ICD_DIAGNOSES.csv.gz
    md5: 9c5b6a1e0c6ebe7a96b99441ca9c0499
  - path: ../data/mimiciii-14/NOTEEVENTS.csv.gz
    md5: d0345c072f1e3107c56cfa76c83b48a9
  - path: pipeline/format_data_for_training.py
    md5: 6230feb0e1c90165691716d9bf4c1e34
  - path: pipeline/xbert_preprocessing.py
    md5: 8b8823e0d97df78bdb9a09b2b4565afd
  - path: requirements.txt
    md5: da8c3ed006b206916c3c7209d3d5c1f0
  params:
    params.yaml:
      prepare_for_xbert.icd_version: 10
      prepare_for_xbert.subsampling: true
  outs:
  - path: ../data/intermediary-data/xbert_inputs/mimiciii-14/X.trn.npz
    md5: bb010b2c7275eccfa4b33358668e4cc8
  - path: ../data/intermediary-data/xbert_inputs/mimiciii-14/X.tst.npz
    md5: 4a20a6e10f386780fff4143ba11df522
  - path: ../data/intermediary-data/xbert_inputs/mimiciii-14/Y.trn.npz
    md5: 4efb1de8ed87831dc9d80d5a24312b99
  - path: ../data/intermediary-data/xbert_inputs/mimiciii-14/Y.tst.npz
    md5: bb02111fa8d33f8e4a77cd632a6497a4
  - path: ../data/intermediary-data/xbert_inputs/mimiciii-14/label_map.txt
    md5: e5a845c0f1c9e9579f1aac411bbb8161
  - path: ../data/intermediary-data/xbert_inputs/mimiciii-14/test_raw_texts.txt
    md5: 12bc84d9702c4fbde63c4ba18c007fbb
  - path: ../data/intermediary-data/xbert_inputs/mimiciii-14/train_raw_texts.txt
    md5: b9fdc28ec9bc59c28b7e62662a74e4da
xbert_label_embedding:
  cmd: cd ./auto-icd-transformers && ./run_preprocess_label.sh
  deps:
  - path: ../data/intermediary-data/xbert_inputs/mimiciii-14/X.trn.npz
    md5: bb010b2c7275eccfa4b33358668e4cc8
  - path: ../data/intermediary-data/xbert_inputs/mimiciii-14/X.tst.npz
    md5: 4a20a6e10f386780fff4143ba11df522
  - path: ../data/intermediary-data/xbert_inputs/mimiciii-14/Y.trn.npz
    md5: 4efb1de8ed87831dc9d80d5a24312b99
  - path: ../data/intermediary-data/xbert_inputs/mimiciii-14/Y.tst.npz
    md5: bb02111fa8d33f8e4a77cd632a6497a4
  - path: ../data/intermediary-data/xbert_inputs/mimiciii-14/label_map.txt
    md5: e5a845c0f1c9e9579f1aac411bbb8161
  - path: ../data/intermediary-data/xbert_inputs/mimiciii-14/test_raw_texts.txt
    md5: 12bc84d9702c4fbde63c4ba18c007fbb
  - path: ../data/intermediary-data/xbert_inputs/mimiciii-14/train_raw_texts.txt
    md5: b9fdc28ec9bc59c28b7e62662a74e4da
  - path: auto-icd-transformers/environment.yml
    md5: 3cd6521773f3b954d12b25c18b46f8d2
  - path: auto-icd-transformers/run_preprocess_label.sh
    md5: a15a33eb42a299b91f7a887ddccad386
  - path: auto-icd-transformers/xbert/preprocess.py
    md5: 36141b5a7ef3df3bbcb58f57d412c672
  outs:
  - path: ../data/intermediary-data/xbert_outputs/pifa-tfidf-s0/indexer/code.npz
    md5: 1b7eefbcad132b3eb287cfcc070bbe59
  - path: ../data/intermediary-data/xbert_outputs/pifa-tfidf-s0/indexer/config.json
    md5: 0c33de1953d3e052b2af3a829adc73c2
  - path: ../data/intermediary-data/xbert_outputs/pifa-tfidf-s1/indexer/code.npz
    md5: 6cb367de2f0b44b7264484f56afb5f54
  - path: ../data/intermediary-data/xbert_outputs/pifa-tfidf-s1/indexer/config.json
    md5: 40623db8da3ac454339b585c1bcac119
  - path: ../data/intermediary-data/xbert_outputs/pifa-tfidf-s2/indexer/code.npz
    md5: ec205d906a02f66f50b27abbd2a98048
  - path: ../data/intermediary-data/xbert_outputs/pifa-tfidf-s2/indexer/config.json
    md5: 00f8d21dc4d93354fd07c3672a3f81c2
  - path: ../data/intermediary-data/xbert_outputs/proc_data/C.trn.pifa-tfidf-s0.npz
    md5: 3d3664bc57afde5b12837ac829d9340b
  - path: ../data/intermediary-data/xbert_outputs/proc_data/C.tst.pifa-tfidf-s0.npz
    md5: 00da3e13b7763238f58196ffe75fc6b7
  - path: ../data/intermediary-data/xbert_outputs/proc_data/L.pifa-tfidf.npz
    md5: 0cfec878e4f85b3bc55c014dcc5b35de
xbert_feat_embedding:
  cmd: cd ./auto-icd-transformers && ./run_preprocess_feat.sh
  deps:
  - path: ../data/intermediary-data/xbert_inputs/mimiciii-14/X.trn.npz
    md5: bb010b2c7275eccfa4b33358668e4cc8
  - path: ../data/intermediary-data/xbert_inputs/mimiciii-14/X.tst.npz
    md5: 4a20a6e10f386780fff4143ba11df522
  - path: ../data/intermediary-data/xbert_inputs/mimiciii-14/Y.trn.npz
    md5: 4efb1de8ed87831dc9d80d5a24312b99
  - path: ../data/intermediary-data/xbert_inputs/mimiciii-14/Y.tst.npz
    md5: bb02111fa8d33f8e4a77cd632a6497a4
  - path: ../data/intermediary-data/xbert_inputs/mimiciii-14/test_raw_texts.txt
    md5: 12bc84d9702c4fbde63c4ba18c007fbb
  - path: ../data/intermediary-data/xbert_inputs/mimiciii-14/train_raw_texts.txt
    md5: b9fdc28ec9bc59c28b7e62662a74e4da
  - path: auto-icd-transformers/environment.yml
    md5: 3cd6521773f3b954d12b25c18b46f8d2
  - path: auto-icd-transformers/run_preprocess_feat.sh
    md5: 3327c917dad69cbb168463431080c809
  - path: auto-icd-transformers/xbert/preprocess.py
    md5: 36141b5a7ef3df3bbcb58f57d412c672
  params:
    params.yaml:
      max_seq_len: 24
  outs:
  - path: ../data/intermediary-data/xbert_outputs/proc_data/X.trn.bert.pkl
    md5: 4598d6555a71546e85176d9f0ca9741a
  - path: ../data/intermediary-data/xbert_outputs/proc_data/X.tst.bert.pkl
    md5: e3c88268b1cbb82b39d82031103d9a55
xbert_model_training:
  cmd: cd ./auto-icd-transformers && ./run_transformer_train.sh
  deps:
  - path: ../data/intermediary-data/xbert_outputs/proc_data/C.trn.pifa-tfidf-s0.npz
    md5: 3d3664bc57afde5b12837ac829d9340b
  - path: ../data/intermediary-data/xbert_outputs/proc_data/C.tst.pifa-tfidf-s0.npz
    md5: 00da3e13b7763238f58196ffe75fc6b7
  - path: ../data/intermediary-data/xbert_outputs/proc_data/L.pifa-tfidf.npz
    md5: 0cfec878e4f85b3bc55c014dcc5b35de
  - path: ../data/intermediary-data/xbert_outputs/proc_data/X.trn.bert.pkl
    md5: 4598d6555a71546e85176d9f0ca9741a
  - path: ../data/intermediary-data/xbert_outputs/proc_data/X.tst.bert.pkl
    md5: e3c88268b1cbb82b39d82031103d9a55
  - path: ./auto-icd-transformers/environment.yml
    md5: 3cd6521773f3b954d12b25c18b46f8d2
  - path: ./auto-icd-transformers/run_transformer_train.sh
    md5: fbd6f4661b43d674b4cf25a0818cd5e1
  - path: ./auto-icd-transformers/xbert/transformer.py
    md5: 534b2bf7c2ba728e147773a374d9c083
  params:
    params.yaml:
      max_seq_len: 24
  outs:
  - path: ../data/intermediary-data/xbert_outputs/pifa-tfidf-s0/matcher/Bio_ClinicalBERT/training_args.bin
    md5: fa3e73575fcab39cbe7711b0ee087b95
xbert_trained_model_prediction:
  cmd: cd ./auto-icd-transformers && ./run_transformer_training_prediction.sh
  deps:
  - path: ../data/intermediary-data/xbert_outputs/pifa-tfidf-s0/matcher/Bio_ClinicalBERT/training_args.bin
    md5: fa3e73575fcab39cbe7711b0ee087b95
  - path: ../data/intermediary-data/xbert_outputs/proc_data/C.trn.pifa-tfidf-s0.npz
    md5: 3d3664bc57afde5b12837ac829d9340b
  - path: ../data/intermediary-data/xbert_outputs/proc_data/C.tst.pifa-tfidf-s0.npz
    md5: 00da3e13b7763238f58196ffe75fc6b7
  - path: ../data/intermediary-data/xbert_outputs/proc_data/L.pifa-tfidf.npz
    md5: 0cfec878e4f85b3bc55c014dcc5b35de
  - path: ../data/intermediary-data/xbert_outputs/proc_data/X.trn.bert.pkl
    md5: 4598d6555a71546e85176d9f0ca9741a
  - path: ../data/intermediary-data/xbert_outputs/proc_data/X.tst.bert.pkl
    md5: e3c88268b1cbb82b39d82031103d9a55
  - path: ./auto-icd-transformers/environment.yml
    md5: 3cd6521773f3b954d12b25c18b46f8d2
  - path: ./auto-icd-transformers/run_transformer_train.sh
    md5: fbd6f4661b43d674b4cf25a0818cd5e1
  params:
    params.yaml:
      max_seq_len: 24
  outs:
  - path: ../data/intermediary-data/xbert_outputs/pifa-tfidf-s0/matcher/Bio_ClinicalBERT/C_trn_pred.npz
    md5: 82b7b93ec033e4a49e277420fd5fd093
  - path: ../data/intermediary-data/xbert_outputs/pifa-tfidf-s0/matcher/Bio_ClinicalBERT/C_tst_pred.npz
    md5: a5e358ee24866c600847c7476714bc82
  - path: ../data/intermediary-data/xbert_outputs/pifa-tfidf-s0/matcher/Bio_ClinicalBERT/trn_embeddings.npy
    md5: 0925820144732f2ef05c791766c773f3
  - path: ../data/intermediary-data/xbert_outputs/pifa-tfidf-s0/matcher/Bio_ClinicalBERT/tst_embeddings.npy
    md5: 25ac445f334160fb5d1762ba441d8d5e
xbert_ranker_and_eval:
  cmd: cd ./auto-icd-transformers && ./run_transformer_predict.sh
  deps:
  - path: ../data/intermediary-data/xbert_inputs/mimiciii-14/X.trn.npz
    md5: bb010b2c7275eccfa4b33358668e4cc8
  - path: ../data/intermediary-data/xbert_inputs/mimiciii-14/X.tst.npz
    md5: 4a20a6e10f386780fff4143ba11df522
  - path: ../data/intermediary-data/xbert_inputs/mimiciii-14/Y.trn.npz
    md5: 4efb1de8ed87831dc9d80d5a24312b99
  - path: ../data/intermediary-data/xbert_inputs/mimiciii-14/Y.tst.npz
    md5: bb02111fa8d33f8e4a77cd632a6497a4
  - path: ../data/intermediary-data/xbert_outputs/pifa-tfidf-s0/indexer/code.npz
    md5: 1b7eefbcad132b3eb287cfcc070bbe59
  - path: ../data/intermediary-data/xbert_outputs/pifa-tfidf-s0/matcher/Bio_ClinicalBERT/C_trn_pred.npz
    md5: 82b7b93ec033e4a49e277420fd5fd093
  - path: ../data/intermediary-data/xbert_outputs/pifa-tfidf-s0/matcher/Bio_ClinicalBERT/C_tst_pred.npz
    md5: a5e358ee24866c600847c7476714bc82
  - path: ../data/intermediary-data/xbert_outputs/pifa-tfidf-s0/matcher/Bio_ClinicalBERT/trn_embeddings.npy
    md5: 0925820144732f2ef05c791766c773f3
  - path: ../data/intermediary-data/xbert_outputs/pifa-tfidf-s0/matcher/Bio_ClinicalBERT/tst_embeddings.npy
    md5: 25ac445f334160fb5d1762ba441d8d5e
  - path: ./auto-icd-transformers/environment.yml
    md5: 3cd6521773f3b954d12b25c18b46f8d2
  - path: ./auto-icd-transformers/run_transformer_predict.sh
    md5: e5245eb4c973c966fd1545156afd8ccf
  - path: ./auto-icd-transformers/xbert/evaluator.py
    md5: db7fc81df488eff294e7f9738c7c1162
  - path: ./auto-icd-transformers/xbert/ranker.py
    md5: 594009ea20d82965f0f35371a0902f05
  outs:
  - path: ../data/intermediary-data/xbert_outputs/pifa-tfidf-s0/ranker/Bio_ClinicalBERT/tst.pred.npz
    md5: df75025b1f32c96c10d03c6578443ae7
